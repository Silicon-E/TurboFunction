# Turbo
### .mcfunction Preprocessor

Turbo speeds up your .mcfunction coding with constructs including constants, macros, code blocks, and local functions.

# Syntax

Turbo acts on source files. Each source file represents a function. Turbo source files are text files in the `data/` folder of a data pack that have filenames endind in "` SRC.mcfunction`" (note the separating space). These files are discarded by Minecraft when it loads the data pack. Each Turbo source file compiles to a .mcfunction file at the same location with the same name, sans the "` SRC`" suffix.

Turbo source files consist of lines separated by line endings. Each line is one of:
- Whitespace
- A comment
- A command
- A preprocessor directive

Whitespace and comments are transcluded into the output.
Some directives define **symbols**. Symbols are names containing *uppercase letters, underscores, and numbers*.
Commands are transcluded into the output, with any occurrences of symbol names replaced with those symbols' **values**. Where multiple symbols occur, the shortest symbol is replaced first.

### Code Blocks

Some directives mark the beginning of code blocks. A code block is one of these directives, followed by any number of lines, followed by an `##end` directive. Code blocks can contain other code blocks. Lines inside a code block are used by the opening directive and are not transcluded into the containing scope.

## Directives

### ##end
Marks the end of a code block.

### ##define

Defines a type of symbol called a **macro**. The value of a macro is the text supplied to the `##define` directive that defined it.

`##define` directives have two forms:
> ```
> ##define <name>[( <arg1 name> , <arg2 name> , ... )] <value>
> 
> ##define <name>[( <arg name> , ... )]
>     <value>
>     ...
> ##end
> ```
> `name` - A valid symbol name.
> 
> `value` - Any text. The macro's argument symbols are in scope throughout the value.

Macros may have arguments. Macros with one or more arguments are defined and used like this:
```
##define FOO(ARG1, ARG2) Args are ARG1 and ARG2
FOO(bar, baz)
```
Where a macro is invoked with arguments, whitespace on either side of the argument is discarded. Put your argument in double quotes (like `" baz "`) if you want some surrounding whitespace to be included.

#### Example
```
##define OFFSET ~0 ~15.1 ~2
##define HANDLE_ENTITY(ENTITY_ID, PARTICLE)
    execute at @e[type=ENTITY_ID] run particle PARTICLE OFFSET
##end
HANDLE_ENTITY(creeper, block lime_wool)
HANDLE_ENTITY(player,  instant_effect)
```

### ##block

Generates an `execute` command that conditionally executes a block of code.

> ```
> ##block
> <execute template>
>   <body>
>   ...
> ##end
> ```
> `execute template` - An `execute` command missing the `run` subcommand
> 
> `body` - Zero or more lines

#### Example
```
##block
execute if block ~ ~ ~ gold_ore
    # Emit breaking FX on the top block.
    particle block gold_ore ~0.5 ~0.5 ~0.5 0.25 0.25 0.25 1 10
    playsound block.stone.break block @a ~0.5 ~0.5 ~0.5 0.5
##end
```
Output:
```
execute if block ~ ~ ~ gold_ore run function mydatapack:path_to_source/__turbo/sourcename_arbitrarysuffix
```

### ##function

Defines a type of symbol called a **local function**. The value of a local function is the namespaced ID of a function generated by Turbo containing the text supplied to the `##function` directive.

> ```
> ##function <name>
>   <body>
>   ...
> ##end
> ```
> `name` - A valid symbol name
> 
> `body` - Zero or more lines

#### Example

```
##function LOOP
    scoreboard players remove #reach num 1
    execute if score #reach num matches 1.. run function LOOP
##end
scoreboard players set #reach num 5
function LOOP
```

### ##include

Defines all the symbols that are defined in another source file.

> ```
> ##include <source>
> ```
> `source` - The namespaced ID of the source file to include symbols from

#### Example

```
##include turbopreprocess:num
OP(#foo num = @s num)
```

### ##insert

Obsolete. Do not use.